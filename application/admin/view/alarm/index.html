{extend name="template/base" /}

{block name="main"}
<div id='toolbar' style="padding: 5px;">
    <div class="btnbar-tools">
        <a href="javascript:;" class="deal"><i class="fa fa-check-circle"></i>处理</a>
    </div>
<!--    <div class="tool-search" style="padding:5px 0 0 0;">
            <label for="order-search-keywords" style="margin-left: 10px;">用户名：</label>
            <input type="text" id="order-search-keywords" class="easyui-textbox">
            <label for="order-search-keywords">姓名：</label>
            <input type="text" id="order-search-date-type" class="easyui-textbox">
            <a href="javascript:void(0)" class="easyui-linkbutton" data-options='iconCls:"fa fa-search"' onclick="orderOpt.search()">查询</a>
    </div>-->
</div>
<table id="dataGrid" data-options="border:false"></table>


<script type="text/javascript">
    var datagrid_url = '{:url("/admin/alarm/data_grid")}',
            deal_url = '{:url("/admin/alarm/deal")}';

    var dataGrid;
    var dlg = '';

    $(function () {
        dataGrid = $('#dataGrid').datagrid({
            url: datagrid_url,
            toolbar: '#toolbar',
            //fitColumns: true,
            fit: true,
            //height:$(document).height()-85,
            //width:$(document).width(),
            sortName: 'id',
            sortOrder: 'desc',
            idField: 'id',
            pageSize: 30,
            pageList: [10, 20, 30, 40, 50],
            pagination: true,
            striped: true, //奇偶行是否区分
            //singleSelect: true,//单选模式
            rownumbers: true, //行号
            columns: [[
                    {field: 'id', title: '编号', checkbox: true},
                    {field: 'recordid', title: '记录号', width: 100, sortable: true},
                    {field: 'sale_type', title: '销售性质', width: 100},
                    {field: 'productid', title: '产品型号', width: 100},
                    {field: 'num', title: '数量', width: 80},
                    {field: 'deviceid', title: '机台号', width: 80},
                    {field: 'deadline', title: '交期', width: 100,sortable: true,
                        formatter: function (value, row,index){
                            var oDate1 = new Date();
                            var oDate2 = new Date(row.deadline);
                            if(oDate1.getTime() >= oDate2.getTime()){
                                return '<span style="color:red;">('+value+')</span>';
                            }else{
                                return value;
                            }
                                                }
                    },
                    {field: 'create_person', title: '创建人', width: 100},
                    {field: 'create_time', title: '创建时间', width: 150},
                    {field: 'state', title: '状态', width: 100,
                        formatter: function (value, row, index) {
                            if (value === '已处理') {
                                return value + '<i class="fa fa-check-circle"></i>';
                            } else {
                                return '<span style="color: red;">待处理</span>';
                            }
                        }
                    },
                ]]
        });

        //刷新dataGrid
        $('#btnReload').click(function () {
            dataGrid.datagrid('reload');
        });

//        $('#search').click(function () {
//            var recordid = $('#order-search-keywords').textbox('getValue');
//            var deadline = $('#search_deadline').textbox('getValue');
//            var startDate = $('#search_startDate').textbox('getValue');
//            var endDate = $('#search_endDate').textbox('getValue');
//            dataGrid.datagrid({
//                queryParams: {
//                    recordid: recordid,
//                    deadline: deadline,
//                    endDate: endDate,
//                    startDate: startDate
//                }
//            });
//        });

        //处理
        $(".deal").click(function () {
            var rows = dataGrid.datagrid('getSelections');
            if (rows.length > 0) {
                $.messager.confirm('警告', '是否真的处理该记录？', function (r) {
                    if (r) {
                        var ids = [];
                        for (var i = 0; i < rows.length; i++) {
                            ids.push(rows[i].id);
                        }
                        $.post(deal_url, {ids: ids.join(',')}, function (result) {
                            if (result.Success) {
                                dataGrid.datagrid('clearSelections');
                                dataGrid.datagrid('reload');
                            }
                            layer.msg(result.Message);
                        });
                    }
                });
            } else {
                layer.msg('请先选择记录后再进行删除。');
            }
            //dataGrid.datagrid('clearSelections');
        });


    });

</script>

{/block}