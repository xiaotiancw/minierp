{extend name="template/base" /}

{block name="main"}
<div id='toolbar' style="padding: 5px;">
    <div class="btnbar-tools">
        <a href="javascript:;" class="add" id="newData"><i class="fa fa-plus-square success"></i>添加</a>
        <a href="javascript:;" class="edit"><i class="fa fa-pencil-square info"></i>编辑</a>
        <a href="javascript:;" class="del"><i class="fa fa-times-rectangle danger"></i>删除</a>
        <a href="javascript:;" class="count"><i class="fa fa-pie-chart purple"></i>统计</a>

        <a href="javascript:;" class="export"><i class="fa fa-file-excel-o yellow"></i>导出Excel</a>

    </div>
    <div class="tool-search" style="padding:5px 0 0 0;">
        <label for="order-search-keywords" style="margin-left: 10px;">用户名：</label>
        <input type="text" id="order-search-keywords" class="easyui-textbox">
        <label for="order-search-keywords">姓名：</label>
        <input type="text" id="order-search-date-type" class="easyui-textbox">
        <label for="order-search-keywords">时间区间：</label>
        <input type="text" id="order-search-date-from" class="easyui-datebox">
        <label for="order-search-date-to">-</label>
        <input type="text" id="order-search-date-to" class="easyui-datebox">
        <a href="javascript:void(0)" class="easyui-linkbutton" data-options='iconCls:"fa fa-search"' onclick="orderOpt.search()">查询</a>
    </div>
</div>
<table id="dataGrid" data-options="border:false"></table>

<script type="text/javascript">
        var datagrid_url =  '{:url("/admin/staff/data_grid")}',
            add_url =  '{:url("/admin/staff/create")}',
            edit_url =  '{:url("/admin/staff/edit")}',
            delete_url =  '{:url("/admin/staff/delete")}',
            detail_url =  '{:url("/admin/staff/detail")}',
            export_url = '{:url("/admin/staff/export")}',
            staff_combogrid_url = '{:url("/admin/staff/combo_grid")}';
    var dataGrid;
    var dlg = '';

    $(function () {
        dataGrid = $('#dataGrid').datagrid({
            url: datagrid_url,
            toolbar: '#toolbar',
            //fitColumns: true,
            fit: true,
            //height:$(document).height()-85,
            //width:$(document).width(),
            sortName: 'id',
            sortOrder: 'desc',
            idField: 'id',
            pageSize: 30,
            pageList: [10, 20, 30, 40, 50],
            pagination: true,
            striped: true, //奇偶行是否区分
            //singleSelect: true,//单选模式
            rownumbers: true, //行号
            columns: [[
                    {field : 'id',title : '自动编号',width : 100,checkbox : true},
                    {field : 'number',title : '工号',width : 70,sortable : true},
                    {field : 'name',title : '姓名',width : 100},
                    {field : 'gender',title : '性别',width : 70,sortable : true},
                    {field : 'id_card',title : '身份证',width : 170},
                    {field : 'post',title : '职位',width : 100},
                    {field : 'nation',title : '民族',width: 100},
                    {field: 'type',title: '员工类型',width: 100,sortable: true},
                    {field: 'tel',title: '移动电话',width: 120},
                    {field: 'entry_status',title: '入职状态',width: 100,sortable: true},
                    {field: 'entry_date',title: '入职时间',width: 100,sortable: true},
                    {field: 'marital_status',title: '婚姻状况',width: 100,sortable: true},
                    {field: 'education',title: '学历',width: 70,sortable: true},
                    {field: 'create_time',title: '创建时间',hidden: true},
                    {field: 'details',title: '详情',width: 40,fixed: true,
                        formatter: function (value, row,index){
                            //return "<a>详情</a>";
                            return '<a href="javascript:void(0)" class="easyui-linkbutton" data-options="" style="height: 18px;margin-left: 2px;" onclick="details(' + row.id + ')">详情</a>';
                        }
                    }
                ]]
        });

        //刷新dataGrid
        $('#btnReload').click(function () {
            dataGrid.datagrid('reload');
        });

        $('#search').click(function () {
            var recordid = $('#search_recordid').textbox('getValue');
            var deadline = $('#search_deadline').textbox('getValue');
            var startDate = $('#search_startDate').textbox('getValue');
            var endDate = $('#search_endDate').textbox('getValue');
            dataGrid.datagrid({
                queryParams: {
                    recordid: recordid,
                    deadline: deadline,
                    endDate: endDate,
                    startDate: startDate
                }
            });
        });
        
        //新增数据
        $('.add').on('click', function () {
            //$('#formAdd').form('clear');
            dlg = layer.open({
                title: '新增',
                type: 2,
                skin: 'layui-layer-rim', //加上边框
                shadeClose: true,
                shade: false,
                maxmin: true, //开启最大化最小化按钮
                area: ['1000px', '500px'], //宽高
                content: add_url,
                zIndex: 1000
            });
        });

        //删除
        $(".del").click(function () {
            var rows = dataGrid.datagrid('getSelections');
            if (rows.length > 0) {
                $.messager.confirm('警告', '是否真的删除该记录？', function (r) {
                    if (r) {
                        var ids = [];
                        for (var i = 0; i < rows.length; i++) {
                            ids.push(rows[i].id);
                        }
                        $.post('../record/delete', {ids: ids.join(',')}, function (result) {
                            if (result.Success) {
                                dataGrid.datagrid('reload');
                            }
                            layer.msg(result.Message);
                        });
                    }
                });
            } else {
                layer.msg('请先选择记录后再进行删除。');
            }
            //dataGrid.datagrid('clearSelections');
        });



        //导出
        $(".export").click(function () {
            var rows = dataGrid.datagrid('getSelections');
            if (rows.length > 0) {
                $.messager.confirm('警告', '是否真的导出记录？', function (r) {
                    if (r) {
                        var ids = [];
                        for (var i = 0; i < rows.length; i++) {
                            ids.push(rows[i].id);
                            //alert(rows[i]);
                        }
                        window.location.href = '../record/export/ids/' + ids.join(',');
                    }
                });
            } else {
                layer.msg('请先选择记录后再打开。');
            }
        });


    });






</script>

{/block}